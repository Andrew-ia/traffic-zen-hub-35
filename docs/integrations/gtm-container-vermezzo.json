{
  "exportFormatVersion": 2,
  "containerVersion": {
    "container": {
      "name": "Vermezzo",
      "publicId": "GTM-N8PFFF7J",
      "usageContext": ["web"]
    },
    "builtInVariable": [
      { "type": "CLICK_URL" },
      { "type": "PAGE_URL" }
    ],
    "variable": [
      {
        "name": "dlv - items",
        "type": "DATA_LAYER",
        "parameter": [
          { "type": "TEMPLATE", "key": "name", "value": "items" }
        ]
      },
      {
        "name": "dlv - item_list_id",
        "type": "DATA_LAYER",
        "parameter": [
          { "type": "TEMPLATE", "key": "name", "value": "item_list_id" }
        ]
      },
      {
        "name": "dlv - item_list_name",
        "type": "DATA_LAYER",
        "parameter": [
          { "type": "TEMPLATE", "key": "name", "value": "item_list_name" }
        ]
      },
      {
        "name": "dlv - value",
        "type": "DATA_LAYER",
        "parameter": [
          { "type": "TEMPLATE", "key": "name", "value": "value" }
        ]
      },
      {
        "name": "dlv - currency",
        "type": "DATA_LAYER",
        "parameter": [
          { "type": "TEMPLATE", "key": "name", "value": "currency" }
        ]
      },
      {
        "name": "js - wpp_phone_from_url",
        "type": "CUSTOM_JS",
        "parameter": [
          {
            "type": "TEMPLATE",
            "key": "javascript",
            "value": "function(){try{var u={{Click URL}}||{{Page URL}}||'';var m=u.match(/(?:wa\\.me\\/|phone=)(\\+?\\d{10,15})/);return m?m[1]:undefined;}catch(e){return undefined;}}"
          }
        ]
      }
    ],
    "trigger": [
      {
        "triggerId": "1",
        "name": "Initialization - All Pages",
        "type": "INITIALIZATION"
      },
      {
        "triggerId": "2",
        "name": "ce_view_item_list",
        "type": "CUSTOM_EVENT",
        "customEventFilter": [
          {
            "type": "EQUALS",
            "parameter": [
              { "type": "TEMPLATE", "key": "arg0", "value": "{{_event}}" },
              { "type": "TEMPLATE", "key": "arg1", "value": "view_item_list" }
            ]
          }
        ]
      },
      {
        "triggerId": "3",
        "name": "ce_select_item",
        "type": "CUSTOM_EVENT",
        "customEventFilter": [
          {
            "type": "EQUALS",
            "parameter": [
              { "type": "TEMPLATE", "key": "arg0", "value": "{{_event}}" },
              { "type": "TEMPLATE", "key": "arg1", "value": "select_item" }
            ]
          }
        ]
      },
      {
        "triggerId": "4",
        "name": "ce_view_cart",
        "type": "CUSTOM_EVENT",
        "customEventFilter": [
          {
            "type": "EQUALS",
            "parameter": [
              { "type": "TEMPLATE", "key": "arg0", "value": "{{_event}}" },
              { "type": "TEMPLATE", "key": "arg1", "value": "view_cart" }
            ]
          }
        ]
      },
      {
        "triggerId": "5",
        "name": "lc_whatsapp_click",
        "type": "LINK_CLICK",
        "filter": [
          {
            "type": "MATCH_REGEX",
            "parameter": [
              { "type": "TEMPLATE", "key": "arg0", "value": "{{Click URL}}" },
              { "type": "TEMPLATE", "key": "arg1", "value": "^https?:\\/\\/(api\\.whatsapp\\.com|wa\\.me|wa\\.whatsapp\\.com)\\/.*" }
            ]
          }
        ]
      }
    ],
    "tag": [
      {
        "name": "GA4 - Config Vermezzo",
        "type": "gaawc",
        "parameter": [
          { "type": "BOOLEAN", "key": "sendPageView", "value": "true" },
          { "type": "BOOLEAN", "key": "enableSendToServerContainer", "value": "false" },
          { "type": "TEMPLATE", "key": "measurementId", "value": "G-FCC95TVZ29" }
        ],
        "firingTriggerId": ["1"],
        "tagFiringOption": "ONCE_PER_LOAD"
      },
      {
        "name": "GA4 - view_item_list",
        "type": "gaawe",
        "parameter": [
          { "type": "TEMPLATE", "key": "eventName", "value": "view_item_list" },
          {
            "type": "LIST",
            "key": "eventParameters",
            "list": [
              { "type": "MAP", "map": [
                { "type": "TEMPLATE", "key": "name", "value": "item_list_id" },
                { "type": "TEMPLATE", "key": "value", "value": "{{dlv - item_list_id}}" }
              ]},
              { "type": "MAP", "map": [
                { "type": "TEMPLATE", "key": "name", "value": "item_list_name" },
                { "type": "TEMPLATE", "key": "value", "value": "{{dlv - item_list_name}}" }
              ]},
              { "type": "MAP", "map": [
                { "type": "TEMPLATE", "key": "name", "value": "items" },
                { "type": "TEMPLATE", "key": "value", "value": "{{dlv - items}}" }
              ]},
              { "type": "MAP", "map": [
                { "type": "TEMPLATE", "key": "name", "value": "currency" },
                { "type": "TEMPLATE", "key": "value", "value": "{{dlv - currency}}" }
              ]},
              { "type": "MAP", "map": [
                { "type": "TEMPLATE", "key": "name", "value": "value" },
                { "type": "TEMPLATE", "key": "value", "value": "{{dlv - value}}" }
              ]}
            ]
          },
          { "type": "TAG_REFERENCE", "key": "measurementId", "value": "GA4 - Config Vermezzo" }
        ],
        "firingTriggerId": ["2"]
      },
      {
        "name": "GA4 - select_item",
        "type": "gaawe",
        "parameter": [
          { "type": "TEMPLATE", "key": "eventName", "value": "select_item" },
          {
            "type": "LIST",
            "key": "eventParameters",
            "list": [
              { "type": "MAP", "map": [
                { "type": "TEMPLATE", "key": "name", "value": "item_list_id" },
                { "type": "TEMPLATE", "key": "value", "value": "{{dlv - item_list_id}}" }
              ]},
              { "type": "MAP", "map": [
                { "type": "TEMPLATE", "key": "name", "value": "item_list_name" },
                { "type": "TEMPLATE", "key": "value", "value": "{{dlv - item_list_name}}" }
              ]},
              { "type": "MAP", "map": [
                { "type": "TEMPLATE", "key": "name", "value": "items" },
                { "type": "TEMPLATE", "key": "value", "value": "{{dlv - items}}" }
              ]}
            ]
          },
          { "type": "TAG_REFERENCE", "key": "measurementId", "value": "GA4 - Config Vermezzo" }
        ],
        "firingTriggerId": ["3"]
      },
      {
        "name": "GA4 - view_cart",
        "type": "gaawe",
        "parameter": [
          { "type": "TEMPLATE", "key": "eventName", "value": "view_cart" },
          {
            "type": "LIST",
            "key": "eventParameters",
            "list": [
              { "type": "MAP", "map": [
                { "type": "TEMPLATE", "key": "name", "value": "value" },
                { "type": "TEMPLATE", "key": "value", "value": "{{dlv - value}}" }
              ]},
              { "type": "MAP", "map": [
                { "type": "TEMPLATE", "key": "name", "value": "currency" },
                { "type": "TEMPLATE", "key": "value", "value": "{{dlv - currency}}" }
              ]},
              { "type": "MAP", "map": [
                { "type": "TEMPLATE", "key": "name", "value": "items" },
                { "type": "TEMPLATE", "key": "value", "value": "{{dlv - items}}" }
              ]}
            ]
          },
          { "type": "TAG_REFERENCE", "key": "measurementId", "value": "GA4 - Config Vermezzo" }
        ],
        "firingTriggerId": ["4"]
      },
      {
        "name": "GA4 - whatsapp_click",
        "type": "gaawe",
        "parameter": [
          { "type": "TEMPLATE", "key": "eventName", "value": "whatsapp_click" },
          {
            "type": "LIST",
            "key": "eventParameters",
            "list": [
              { "type": "MAP", "map": [
                { "type": "TEMPLATE", "key": "name", "value": "link_url" },
                { "type": "TEMPLATE", "key": "value", "value": "{{Click URL}}" }
              ]},
              { "type": "MAP", "map": [
                { "type": "TEMPLATE", "key": "name", "value": "phone" },
                { "type": "TEMPLATE", "key": "value", "value": "{{js - wpp_phone_from_url}}" }
              ]}
            ]
          },
          { "type": "TAG_REFERENCE", "key": "measurementId", "value": "GA4 - Config Vermezzo" }
        ],
        "firingTriggerId": ["5"]
      },
      {
        "name": "Meta Pixel - Lead on WhatsApp",
        "type": "html",
        "parameter": [
          {
            "type": "TEMPLATE",
            "key": "html",
            "value": "<script>try{if(window.fbq){fbq('track','Lead',{source:'whatsapp_click'});} }catch(e){}</script>"
          },
          { "type": "BOOLEAN", "key": "supportDocumentWrite", "value": "false" }
        ],
        "firingTriggerId": ["5"],
        "tagFiringOption": "ONCE_PER_EVENT"
      }
    ]
  }
}

